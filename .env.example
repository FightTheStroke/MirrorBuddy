# ============================================================================
# MirrorBuddy - ENVIRONMENT CONFIGURATION
# https://github.com/FightTheStroke/MirrorBuddy
#
# Copy this file to .env and fill in your values
# Contact: roberdan@fightthestroke.org
# ============================================================================

# ============================================================================
# AI PROVIDERS (Choose one for chat, Azure required for voice)
# ============================================================================

# Option 1: Azure OpenAI (Recommended for production)
# All Azure endpoints must be configured for full functionality
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com
AZURE_OPENAI_API_KEY=your-api-key
AZURE_OPENAI_CHAT_DEPLOYMENT=gpt-5-mini

# GPT-5 family deployments (primary models, replacing retired GPT-4o family)
AZURE_OPENAI_GPT5_NANO_DEPLOYMENT=gpt-5-nano
AZURE_OPENAI_GPT5_MINI_DEPLOYMENT=gpt-5-edu-mini
AZURE_OPENAI_GPT52_CHAT_DEPLOYMENT=gpt-5.2-chat
AZURE_OPENAI_GPT52_EDU_DEPLOYMENT=gpt-5.2-edu

# Default model names for tier seeds and fallbacks
# Change these to migrate all tiers without code changes
DEFAULT_CHAT_MODEL=gpt-5-mini
DEFAULT_CHAT_MODEL_EDU=gpt-5.2-edu
DEFAULT_CHAT_MODEL_PRO=gpt-5.2-chat
DEFAULT_DEMO_MODEL=gpt-5-nano
DEFAULT_EXTRACTOR_MODEL=gpt-5-nano

# Legacy GPT-4o (retiring 2026-03-31 Standard, 2026-10-01 Provisioned)
# Keep only if existing deployments still active during transition
# AZURE_OPENAI_GPT4O_DEPLOYMENT=gpt-4o

# RAG Embeddings (for semantic search)
# Options (all 1536 dims):
#   - text-embedding-3-small (recommended, best quality)
#   - text-embedding-ada-002 (fallback if 3-small unavailable in your region)
# Create: az cognitiveservices account deployment create \
#   --name your-resource --resource-group your-rg \
#   --deployment-name text-embedding-ada-002 --model-name text-embedding-ada-002 \
#   --model-version 2 --model-format OpenAI --sku-capacity 10 --sku-name Standard
AZURE_OPENAI_EMBEDDING_DEPLOYMENT=text-embedding-3-small

# Voice Features (Azure OpenAI Realtime GA - REQUIRED for voice)
# Voice will not work without these - text chat fallback will be shown
#
# GA endpoint uses /openai/v1/realtime/ path convention (no api-version param).
# The resource domain (your-resource.openai.azure.com) is used for both
# ephemeral token and WebRTC SDP exchange -- no separate regional domain.
#
# Available GA models:
#   - gpt-realtime (2025-08-28) - GA, recommended, best quality
#   - gpt-realtime-mini (2025-12-15) - GA, faster, lower cost
#   - gpt-4o-realtime-preview - RETIRED 30 April 2026, do NOT use
#
# Create deployment: az cognitiveservices account deployment create \
#   --name your-resource --resource-group your-rg \
#   --deployment-name gpt-realtime --model-name gpt-realtime --model-version 2025-08-28 \
#   --sku-name GlobalStandard --sku-capacity 1
#
AZURE_OPENAI_REALTIME_ENDPOINT=https://your-resource.openai.azure.com
AZURE_OPENAI_REALTIME_API_KEY=your-api-key
AZURE_OPENAI_REALTIME_DEPLOYMENT=gpt-4o-realtime

# Cost Optimization: Use mini model by default, premium for MirrorBuddy only
# Mini model deployment (80-90% cheaper, good quality for most use cases)
# Premium model (AZURE_OPENAI_REALTIME_DEPLOYMENT) will be used ONLY for MirrorBuddy
AZURE_OPENAI_REALTIME_DEPLOYMENT_MINI=gpt-realtime-mini

# LiveKit (voice room infrastructure)
LIVEKIT_URL=wss://your-project.livekit.cloud
LIVEKIT_API_KEY=your-livekit-api-key
LIVEKIT_API_SECRET=your-livekit-api-secret
NEXT_PUBLIC_LIVEKIT_URL=wss://your-project.livekit.cloud

# DEPRECATED Voice Vars (do NOT set -- will be removed from code in future release)
# AZURE_OPENAI_REALTIME_REGION - DEPRECATED: GA uses resource endpoint directly,
#   region is embedded in the AZURE_OPENAI_REALTIME_ENDPOINT domain name.
#   Previously used to construct {region}.realtimeapi-preview.ai.azure.com.
# AZURE_OPENAI_REALTIME_API_VERSION - DEPRECATED: GA uses /v1/ path versioning,
#   no api-version query parameter needed. Previously set to 2024-10-01-preview.

# Text-to-Speech (TTS) for accessibility features
# Uses the same endpoint as chat, separate deployment for TTS model
AZURE_OPENAI_TTS_DEPLOYMENT=tts-hd-deployment

# Option 2: Ollama (100% local, free, chat/text only)
# If Azure is not configured, the app will automatically try Ollama
# Voice features will NOT work with Ollama (realtime audio not supported)
OLLAMA_URL=http://localhost:11434
OLLAMA_MODEL=llama3.2

# ============================================================================
# AZURE COST MANAGEMENT (Optional - for cost tracking in Settings)
# ============================================================================

# To enable cost tracking, you need a Service Principal with "Cost Management Reader" role:
#
# 1. Create App Registration in Azure AD:
#    az ad app create --display-name "mirrorbuddy Cost Reader"
#
# 2. Create Service Principal:
#    az ad sp create --id <app-id>
#
# 3. Create client secret:
#    az ad app credential reset --id <app-id>
#
# 4. Assign "Cost Management Reader" role on subscription:
#    az role assignment create \
#      --assignee <service-principal-id> \
#      --role "Cost Management Reader" \
#      --scope /subscriptions/<subscription-id>

# ============================================================================
# SENTRY (Error Tracking - Recommended for production)
# ============================================================================

# Sentry DSN for client and server error tracking
# Get from: Sentry > Settings > Projects > Your Project > Client Keys (DSN)
# Dashboard: https://sentry.io
NEXT_PUBLIC_SENTRY_DSN=https://your-key@your-org.ingest.us.sentry.io/your-project-id

# Sentry Build (for source maps upload in CI)
# Auth token: Sentry > Settings > Auth Tokens > Create (scopes: project:releases, org:read)
# Required for: release tracking, source maps upload, commit association
SENTRY_AUTH_TOKEN=your-sentry-auth-token
SENTRY_ORG=your-sentry-org
SENTRY_PROJECT=your-sentry-project

# ============================================================================
# GRAFANA CLOUD (Optional - for enterprise observability)
# ============================================================================

# Grafana Cloud remote write for Prometheus metrics
# Get from Grafana Cloud > Connections > Hosted Prometheus > Details
#
# URL format: https://prometheus-prod-XX-prod-{region}.grafana.net/api/prom/push
# User: numeric instance ID (e.g., 123456)
# API Key: create at Grafana Cloud > Access Policies > Create token with metrics:write
#
# If not configured, metrics are only available via pull at /api/metrics
GRAFANA_CLOUD_PROMETHEUS_URL=https://prometheus-prod-XX-prod-region.grafana.net/api/v1/push/influx/write
GRAFANA_CLOUD_PROMETHEUS_USER=your-instance-id
GRAFANA_CLOUD_API_KEY=your-grafana-cloud-api-key

# Push interval in seconds (default: 60, minimum: 15)
GRAFANA_CLOUD_PUSH_INTERVAL=60

# Grafana Service Account Token (for MCP server / API access)
# Create at Grafana Cloud > Administration > Service accounts > Add token
# Format: glsa_xxxxxxxxxxxx
GRAFANA_SERVICE_ACCOUNT_TOKEN=your-grafana-service-account-token

# ============================================================================
# VERCEL API (REQUIRED for CI/CD deployments)
# ============================================================================

# Personal access token for Vercel API integration
# CRITICAL: Required in CI/CD for deployments to production
# OPTIONAL: For local development (if not set, Vercel observability shows 0/0)
#
# How to obtain:
# 1. Go to https://vercel.com/account/tokens
# 2. Click "Create New Token"
# 3. Choose:
#    - Token Name: mirrorbuddy-github-ci (or your preference)
#    - Scope: Full (required for deployment)
#    - Expiration: 90 days (recommended)
# 4. Copy the token immediately (only shown once)
#
# For CI/CD deployment to production:
# - GitHub secret: https://github.com/FightTheStroke/MirrorBuddy/settings/secrets/actions
# - Secret name: VERCEL_TOKEN
# - Rotate every 90 days (security best practice)
#
# Full token rotation guide: docs/operations/VERCEL-TOKEN-MANAGEMENT.md
VERCEL_TOKEN=your-vercel-personal-access-token

# ============================================================================
# DATABASE (PostgreSQL with pgvector required)
# ============================================================================

# Option 1: Local development (requires PostgreSQL with pgvector extension)
# Install: brew install postgresql@17 && brew services start postgresql@17
# Setup:  createdb mirrorbuddy && psql -d mirrorbuddy -c "CREATE EXTENSION vector;"
# DATABASE_URL="postgresql://your-user@localhost:5432/mirrorbuddy"

# Option 2: Supabase via Vercel Marketplace (Recommended for production)
# Add Supabase from Vercel Dashboard > Storage > Create Database > Supabase
# These values are auto-populated by Vercel when you add Supabase
DATABASE_URL="postgres://postgres.YOUR_PROJECT_REF:YOUR_PASSWORD@aws-1-eu-west-1.pooler.supabase.com:6543/postgres?sslmode=require&pgbouncer=true"
DIRECT_URL="postgres://postgres.YOUR_PROJECT_REF:YOUR_PASSWORD@aws-1-eu-west-1.pooler.supabase.com:5432/postgres?sslmode=require"
DEV_DATABASE_URL="postgresql://your-user@localhost:5432/mirrorbuddy_dev"

# E2E Tests (dedicated test database)
TEST_DATABASE_URL="postgresql://your-user@localhost:5432/mirrorbuddy_test"
TEST_DIRECT_URL="postgresql://your-user@localhost:5432/mirrorbuddy_test"

# Supabase Client (for Supabase JS SDK if used)
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
SUPABASE_PUBLISHABLE_KEY=your-anon-key
SUPABASE_SECRET_KEY=your-service-role-key
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=your-anon-key
SUPABASE_JWT_SECRET=your-supabase-jwt-secret

# ============================================================================
# RATE LIMITING (Upstash Redis)
# ============================================================================

# Add Upstash from Vercel Dashboard > Storage > Create Database > Upstash for Redis
# These values are auto-populated by Vercel when you add Upstash
UPSTASH_REDIS_REST_URL=https://xxxxx.upstash.io
UPSTASH_REDIS_REST_TOKEN=your-upstash-token

# ============================================================================
# PUSH NOTIFICATIONS (VAPID - ADR 0014)
# ============================================================================

# Web Push requires VAPID (Voluntary Application Server Identification) keys
# Generate keys: npx web-push generate-vapid-keys
#
# VAPID_SUBJECT: Contact email (mailto:) or URL for push service to contact you
# VAPID_PUBLIC_KEY: Base64 encoded public key (shared with browser)
# VAPID_PRIVATE_KEY: Base64 encoded private key (server-side only, NEVER expose)
VAPID_SUBJECT=mailto:support@mirrorbuddy.org
NEXT_PUBLIC_VAPID_PUBLIC_KEY=your-base64-public-key
VAPID_PRIVATE_KEY=your-base64-private-key

# ============================================================================
# STRIPE PAYMENTS (Pro tier subscription - ADR 0119)
# ============================================================================

# Stripe API keys for payment processing
# Get from: https://dashboard.stripe.com/test/apikeys (test mode)
# or: https://dashboard.stripe.com/apikeys (live mode)
#
# Test mode keys start with sk_test_ / pk_test_
# Live mode keys start with sk_live_ / pk_live_
STRIPE_SECRET_KEY=sk_test_your-stripe-secret-key
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_your-stripe-publishable-key

# Webhook signing secret for signature verification
# Local dev: run `stripe listen --forward-to localhost:3000/api/webhooks/stripe`
#   and copy the whsec_ value from the CLI output
# Production: Stripe Dashboard > Developers > Webhooks > Signing secret
STRIPE_WEBHOOK_SECRET=whsec_your-webhook-signing-secret

# ============================================================================
# TRANSACTIONAL EMAIL (Resend)
# ============================================================================

# Create account at resend.com and generate API key
# Used for: invite emails, credential notifications, password resets
RESEND_API_KEY=re_xxxxx

# Email sender address (must be from a verified domain on Resend)
# Format: "Display Name <email@domain.com>"
# This is used as the FROM address for all transactional emails
# Example: FROM_EMAIL="MirrorBuddy <noreply@mirrorbuddy.org>"
FROM_EMAIL=

# Support/Privacy contact email (used in COPPA templates and legal docs)
# This email should be monitored for privacy/legal inquiries
SUPPORT_EMAIL=

# ============================================================================
# WEB SEARCH (Brave Search API - for real-time information)
# ============================================================================

# Brave Search API enables maestri to access real-time web information
# (tech news, current events, sports results, etc.)
# Without this key, search falls back to Wikipedia only.
#
# Get your API key at: https://brave.com/search/api/
# Free tier: 2,000 queries/month
BRAVE_SEARCH_API_KEY=your-brave-search-api-key

# ============================================================================
# GOOGLE OAUTH (For Google Drive integration - ADR 0040)
# ============================================================================

# Google Drive integration allows users to import study materials directly
# from their Google Drive. Uses read-only scope (drive.readonly).
#
# Setup in Google Cloud Console:
# 1. Create/use existing project: console.cloud.google.com
# 2. Enable Google Drive API: APIs & Services > Library > Google Drive API
# 3. Create OAuth client: APIs & Services > Credentials > Create > OAuth client ID
# 4. Type: "Web application"
# 5. Authorized redirect URIs:
#    - Development: http://localhost:3000/api/auth/google/callback
#    - Production: https://your-domain.com/api/auth/google/callback
# 6. Copy Client ID and Client Secret below

GOOGLE_CLIENT_ID=your-web-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-web-client-secret

# Public client ID for Google Picker API (same as GOOGLE_CLIENT_ID, but exposed to browser)
NEXT_PUBLIC_GOOGLE_CLIENT_ID=your-web-client-id.apps.googleusercontent.com

# Required for OAuth callback URL generation
NEXTAUTH_URL=http://localhost:3000

# ============================================================================
# SITE URL (REQUIRED - used for SEO canonical URLs, hreflang, OG tags)
# ============================================================================

# Public base URL for the site (no trailing slash)
# Development: http://localhost:3000
# Production: https://mirrorbuddy.org
NEXT_PUBLIC_SITE_URL=http://localhost:3000
NEXT_PUBLIC_APP_URL=http://localhost:3000

# ============================================================================
# SESSION SECURITY
# ============================================================================

# Secret key for cryptographically signing session cookies (REQUIRED)
# Must be a strong random string (32+ characters recommended)
#
# Generate a secure secret:
#   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
#   # OR
#   openssl rand -hex 32
#
# IMPORTANT: Keep this secret! Never commit to version control
# Use different secrets for dev/staging/production environments
SESSION_SECRET=your-random-64-character-hex-string-generated-above

# ============================================================================
# CRON JOB SECURITY (For scheduled tasks)
# ============================================================================

# Secret for protecting cron endpoints from unauthorized access
# Required by data retention cron job (/api/cron/data-retention)
# Vercel will include this in the Authorization header when invoking cron
#
# Generate a secure secret:
#   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
#
# IMPORTANT: Must match in vercel.json cron configuration
CRON_SECRET=your-random-32-character-hex-string-for-cron

# ============================================================================
# ENCRYPTION KEYS
# ============================================================================

# Token encryption key (session tokens, CSRF tokens)
# Generate: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
TOKEN_ENCRYPTION_KEY=your-64-char-hex-key-for-token-encryption

# PII encryption key (AES-256-GCM for email, names in database)
# REQUIRED in production - without this, user creation with email will fail
# Generate: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
PII_ENCRYPTION_KEY=your-64-char-hex-key-for-pii-encryption

# ============================================================================
# PROVIDERS THAT ARE NEVER USED (listed for clarity)
# ============================================================================

# OPENAI_API_KEY=xxx        # DO NOT USE - Use Azure OpenAI instead
# ANTHROPIC_API_KEY=xxx     # DO NOT USE - Never use Anthropic

# ============================================================================
# ADMIN SEED (Plan 052 - MVP Beta)
# ============================================================================

# Admin user created on first deploy
# Used for /admin/* routes and initial system access
ADMIN_EMAIL=admin@yourdomain.com
ADMIN_PASSWORD=your-secure-admin-password
ADMIN_READONLY_EMAIL=admin-readonly@yourdomain.com

# Signed cookie value for production admin smoke tests (read-only role)
ADMIN_READONLY_COOKIE_VALUE=your-signed-admin-readonly-cookie

# ============================================================================
# TRIAL MODE (Plan 052 - MVP Beta)
# ============================================================================

# Monthly budget cap for trial users (in EUR)
# When exhausted, trial is suspended globally
TRIAL_BUDGET_LIMIT_EUR=100

# Salt for IP address hashing (security measure for trial session identification)
# Minimum 32 characters recommended, rotate monthly for enhanced privacy
# Generate: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# If not set, a random ephemeral salt is generated per process (not recommended for production)
IP_HASH_SALT=your-random-64-character-hex-string-for-ip-hashing

# ============================================================================
# TEST DATA ISOLATION (Plan 063 - Data Cleanup)
# ============================================================================

# Whitelist of emails to protect from test data cleanup
# Format: comma-separated list of email addresses
# These users will NOT be deleted during database cleanup operations
# Example: roberdan@fightthestroke.org,mariodanfts@gmail.com
#
# If not set, no users are protected (all test data can be deleted)
PROTECTED_USERS=roberdan@fightthestroke.org,mariodanfts@gmail.com

# ============================================================================
# DOCKER DEPLOYMENT (docker-compose)
# ============================================================================

# PostgreSQL credentials for Docker containers
# REQUIRED when using docker-compose up
POSTGRES_USER=mirrorbuddy
POSTGRES_PASSWORD=your-secure-password-here
POSTGRES_HOST=localhost
POSTGRES_DATABASE=mirrorbuddy

# ============================================================================
# MOBILE / iOS RELEASE (Fastlane + Match)
# ============================================================================

# Apple Developer account email (Account Holder or Admin role required)
# Get from: https://developer.apple.com > Account
APPLE_ID=your-apple-id@example.com

# Apple Developer Team ID (10-character alphanumeric)
# Get from: https://developer.apple.com > Membership > Team ID
TEAM_ID=XXXXXXXXXX

# App Store Connect Team ID (for upload to TestFlight/App Store)
# Usually same as TEAM_ID for single-team orgs
# Get from: App Store Connect > Users and Access > your profile
ITC_TEAM_ID=XXXXXXXXXX

# Fastlane user (usually same as APPLE_ID)
FASTLANE_USER=your-apple-id@example.com

# Fastlane Match - Git-based certificate & profile management
# Private git repo URL for storing encrypted certificates
# Create a private repo (e.g., github.com/YourOrg/certificates.git)
# Docs: https://docs.fastlane.tools/actions/match/
MATCH_GIT_URL=https://github.com/YourOrg/certificates.git

# Encryption password for certificates stored in the match repo
# Generate: openssl rand -base64 32
# IMPORTANT: Store securely, losing this = re-create all certificates
MATCH_PASSWORD=your-match-encryption-password

# ============================================================================
# DEPLOYMENT NOTES
# ============================================================================
#
# 1. For Vercel deployment:
#    - Add these variables in Project Settings > Environment Variables
#
# 2. For local development:
#    - Copy this file: cp .env.example .env
#    - Fill in your credentials
#    - Setup PostgreSQL: createdb mirrorbuddy
#    - Run migrations: npx prisma migrate deploy
#    - Run: npm run dev
#
# ============================================================================
# OLLAMA QUICK START (100% local, no cloud, chat only)
# ============================================================================
#
#   # Install Ollama
#   brew install ollama
#
#   # Start server (keep running in terminal)
#   ollama serve
#
#   # Pull a model (in another terminal)
#   ollama pull llama3.2        # Fast, good for education (~2GB)
#   # OR
#   ollama pull mistral         # Alternative (~4GB)
#   # OR
#   ollama pull llama3.1:70b    # Best quality (needs 64GB+ RAM)
#
#   # Then just run the webapp - it will auto-detect Ollama
#   # Note: Voice features require Azure OpenAI Realtime
#
# ============================================================================
