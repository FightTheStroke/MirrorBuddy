# i18n Rules - MirrorBuddy

## MANDATORY: All UI text internationalized. 5 languages from day 1.

**Locales**: `it` (default) | `en` | `fr` | `de` | `es`
**Framework**: next-intl (App Router, server-first)
**Messages**: `messages/{locale}/{namespace}.json` (ADR 0082)
**Namespaces**: common, auth, admin, chat, tools, settings, compliance, education, navigation, errors, welcome, metadata

## CRITICAL: Wrapper Key Convention (ADR 0104)

**ALL JSON files MUST wrap content under a single key matching the filename.**

**Pattern**: `{ "[namespace]": { ...all content... } }`

**Why**: Prevents namespace collisions during loading. In Plan 109, missing wrapper keys caused 98 ESLint warnings + 37 E2E failures when `Object.assign()` merge clobbered duplicate keys (e.g., `compliance` key in both `compliance.json` and `welcome.json`).

**Example**:

```json
// messages/it/compliance.json
{
  "compliance": {
    "title": "Trasparenza IA",
    "sections": { ... }
  }
}
```

**Enforcement**: ESLint rule `no-missing-i18n-keys` validates against this structure.

## Enforcement

| Rule                     | How                                         |
| ------------------------ | ------------------------------------------- |
| No hardcoded text in JSX | ESLint `no-hardcoded-italian`               |
| camelCase keys only      | ESLint `no-kebab-case-i18n-keys` (ADR 0091) |
| All 5 languages synced   | Pre-commit `npm run i18n:check`             |

## Hook Patterns

| When                | Use                       |
| ------------------- | ------------------------- |
| Client component    | `useTranslations('ns')`   |
| Server component    | `getTranslations('ns')`   |
| Multiple namespaces | `useTranslationsGlobal()` |
| Current locale      | `useLocaleContext()`      |

## Adding Keys

1. Add to Italian first: `messages/it/{namespace}.json`
2. Sync: `npx tsx scripts/i18n-sync-namespaces.ts --add-missing`
3. Use: `const t = useTranslations('ns'); t('key')`
4. Verify: `npm run i18n:check`

## Formal Address (ADR 0064)

Historical figures (pre-1900) use formal address (Lei/Sie/Vous).
Set: `FORMAL_PROFESSORS` in `src/lib/greeting/templates/index.ts`

## Verification

```bash
npm run typecheck && npm run i18n:check && npm run build
```

## Full docs: `docs/i18n/` | ADR 0064, 0066, 0082, 0091, 0104
