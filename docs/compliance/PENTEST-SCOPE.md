# Penetration Test Scope Document

**Platform**: MirrorBuddy AI Educational Platform
**Version**: 1.0 | **Date**: February 2026
**Prepared for**: External Security Assessment

---

## 1. Executive Summary

This document defines the scope, boundaries, and focus areas for penetration testing of the MirrorBuddy platform. MirrorBuddy is an AI-powered educational platform serving students with learning differences, including minors.

**Testing Priority**: Authentication, AI safety controls, child data protection, payment processing.

---

## 2. API Endpoint Inventory

### 2.1 CRITICAL Risk (Authentication & Payments)

| Endpoint                        | Methods        | Auth Level | Risk Factors                     |
| ------------------------------- | -------------- | ---------- | -------------------------------- |
| `/api/auth/login`               | POST           | Public     | Credential handling, brute force |
| `/api/auth/logout`              | POST           | User       | Session invalidation             |
| `/api/auth/change-password`     | POST           | User       | Password reset flow              |
| `/api/auth/google`              | GET            | Public     | OAuth initiation                 |
| `/api/auth/google/callback`     | GET            | Public     | OAuth token exchange             |
| `/api/auth/google/token`        | POST           | User       | Token refresh                    |
| `/api/auth/me`                  | GET            | User       | Session validation               |
| `/api/session`                  | GET            | Public     | CSRF token generation            |
| `/api/admin/session`            | GET            | Admin      | Admin session validation         |
| `/api/admin/stripe`             | GET/POST       | Admin      | Payment provider integration     |
| `/api/admin/subscriptions`      | GET/POST       | Admin      | Subscription management          |
| `/api/admin/subscriptions/[id]` | GET/PUT/DELETE | Admin      | Individual subscription          |
| `/api/admin/key-vault`          | GET/POST       | Admin      | Secrets management               |
| `/api/admin/key-vault/[id]`     | GET/PUT/DELETE | Admin      | Individual secrets               |

### 2.2 HIGH Risk (User Data & AI Processing)

| Endpoint                               | Methods        | Auth Level | Risk Factors            |
| -------------------------------------- | -------------- | ---------- | ----------------------- |
| `/api/chat`                            | POST           | User       | AI prompt injection     |
| `/api/chat/stream`                     | POST           | User       | Streaming AI responses  |
| `/api/conversations`                   | GET/POST       | User       | Conversation history    |
| `/api/conversations/[id]`              | GET/PUT/DELETE | User       | Individual conversation |
| `/api/conversations/[id]/messages`     | GET/POST       | User       | Message content         |
| `/api/conversations/memory`            | GET/POST       | User       | AI memory storage       |
| `/api/profile`                         | GET/PUT        | User       | PII modification        |
| `/api/privacy/delete-my-data`          | POST           | User       | Data erasure (GDPR)     |
| `/api/privacy/export-data`             | GET            | User       | Data portability        |
| `/api/coppa`                           | GET/POST       | Public     | COPPA consent flow      |
| `/api/coppa/verify`                    | POST           | Public     | Parental verification   |
| `/api/tos`                             | GET/POST       | Public     | Terms acceptance        |
| `/api/user/consent`                    | GET/POST       | User       | Consent management      |
| `/api/admin/users/[id]`                | GET/PUT/DELETE | Admin      | User management         |
| `/api/admin/users/[id]/reset-password` | POST           | Admin      | Password reset (admin)  |
| `/api/admin/audit-logs`                | GET            | Admin      | Audit trail access      |
| `/api/compliance/audit-log`            | GET            | Admin      | Compliance audit        |

### 2.3 MEDIUM Risk (Educational Features)

| Endpoint                         | Methods        | Auth Level | Risk Factors            |
| -------------------------------- | -------------- | ---------- | ----------------------- |
| `/api/tools/create`              | POST           | User       | Content generation      |
| `/api/tools/stream`              | POST           | User       | Tool streaming          |
| `/api/materials`                 | GET/POST       | User       | Learning materials      |
| `/api/materials/[toolId]`        | GET/PUT/DELETE | User       | Individual materials    |
| `/api/flashcards/progress`       | GET/POST       | User       | Learning progress       |
| `/api/learning-path`             | GET/POST       | User       | Learning paths          |
| `/api/quizzes/results`           | GET/POST       | User       | Quiz submissions        |
| `/api/gamification/points`       | GET/POST       | User       | XP manipulation         |
| `/api/gamification/achievements` | GET            | User       | Achievement tracking    |
| `/api/homework/analyze`          | POST           | User       | Document analysis       |
| `/api/pdf-generator`             | POST           | User       | PDF generation          |
| `/api/study-kit/upload`          | POST           | User       | File uploads            |
| `/api/tts`                       | POST           | User       | Text-to-speech          |
| `/api/realtime/token`            | POST           | User       | WebRTC tokens           |
| `/api/realtime/start`            | POST           | User       | Voice session           |
| `/api/admin/characters`          | GET/POST       | Admin      | AI character management |
| `/api/admin/knowledge/reindex`   | POST           | Admin      | Knowledge base update   |

### 2.4 LOW Risk (Public & Monitoring)

| Endpoint                | Methods | Auth Level | Risk Factors                 |
| ----------------------- | ------- | ---------- | ---------------------------- |
| `/api/health`           | GET     | Public     | Status exposure              |
| `/api/health/detailed`  | GET     | Public     | Detailed health info         |
| `/api/version`          | GET     | Public     | Version disclosure           |
| `/api/maestri`          | GET     | Public     | Character list               |
| `/api/contact`          | POST    | Public     | Contact form (spam)          |
| `/api/metrics`          | POST    | Internal   | Telemetry collection         |
| `/api/telemetry/events` | POST    | User       | Analytics events             |
| `/api/dashboard/*`      | GET     | Admin      | Dashboard data               |
| `/api/cron/*`           | POST    | Internal   | Scheduled jobs (CRON_SECRET) |

---

## 3. Attack Surface Classification

### 3.1 External Attack Surface

| Component        | Technology           | Exposure        |
| ---------------- | -------------------- | --------------- |
| Web Application  | Next.js 15 on Vercel | Public internet |
| API Endpoints    | Next.js API Routes   | Public internet |
| OAuth Provider   | Google OAuth 2.0     | Federated       |
| AI Provider      | Azure OpenAI         | API calls       |
| Payment Provider | Stripe               | Webhooks        |
| Email Provider   | Resend               | Outbound only   |

### 3.2 Authentication Boundaries

```
┌─────────────────────────────────────────────────────────────┐
│                     PUBLIC ZONE                              │
│  - /api/health, /api/version, /api/maestri                  │
│  - /api/auth/login, /api/auth/google                        │
│  - /api/coppa, /api/tos, /api/contact                       │
│  - /api/session (CSRF token)                                │
└─────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────▼─────────┐
                    │   validateAuth()   │
                    │  (session cookie)  │
                    └─────────┬─────────┘
                              │
┌─────────────────────────────▼───────────────────────────────┐
│                   AUTHENTICATED ZONE                         │
│  - /api/chat/*, /api/conversations/*                        │
│  - /api/profile, /api/user/*                                │
│  - /api/tools/*, /api/materials/*                           │
│  - /api/privacy/*, /api/gamification/*                      │
└─────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────▼─────────┐
                    │ validateAdminAuth()│
                    │   (ADMIN_EMAIL)    │
                    └─────────┬─────────┘
                              │
┌─────────────────────────────▼───────────────────────────────┐
│                     ADMIN ZONE                               │
│  - /api/admin/* (all admin endpoints)                       │
│  - User management, subscriptions, audit logs               │
│  - Character/knowledge management                           │
└─────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────▼─────────┐
                    │   CRON_SECRET      │
                    │ (header validation)│
                    └─────────┬─────────┘
                              │
┌─────────────────────────────▼───────────────────────────────┐
│                   INTERNAL ZONE                              │
│  - /api/cron/* (scheduled jobs)                             │
│  - Vercel cron triggers only                                │
└─────────────────────────────────────────────────────────────┘
```

### 3.3 Data Flow: High-Risk Paths

**Authentication Flow**:

```
User → /api/auth/login → PostgreSQL (credentials) → Session cookie
User → /api/auth/google → Google OAuth → /api/auth/google/callback → Session
```

**AI Chat Flow**:

```
User → /api/chat → Safety filters → Azure OpenAI → Content filter → Response
```

**Payment Flow**:

```
User → Stripe Checkout → Stripe webhook → /api/admin/stripe → PostgreSQL
```

---

## 4. External Integrations

| Service       | Data Shared           | Transfer Mechanism | Compliance          |
| ------------- | --------------------- | ------------------ | ------------------- |
| Azure OpenAI  | Sanitized prompts     | API (TLS 1.3)      | EU residency, SOC 2 |
| Stripe        | Payment data          | API + Webhooks     | PCI DSS             |
| Google OAuth  | Email, profile        | OAuth 2.0          | SCCs                |
| Supabase      | Database              | Direct connection  | EU, SOC 2           |
| Resend        | Email addresses       | API                | SCCs                |
| Upstash Redis | Hashed session IDs    | API                | Pseudonymized       |
| Vercel        | Application hosting   | Platform           | SCCs                |
| Sentry        | Error traces (no PII) | API                | SCCs                |
| Grafana Cloud | Metrics (no PII)      | API                | EU available        |

---

## 5. Out-of-Scope Items

### 5.1 Excluded from Testing

| Item                      | Reason                         |
| ------------------------- | ------------------------------ |
| Vercel infrastructure     | Third-party managed            |
| Supabase infrastructure   | Third-party managed            |
| Azure OpenAI service      | Third-party managed            |
| Stripe payment processing | PCI DSS scope                  |
| Google OAuth servers      | Third-party managed            |
| Physical security         | N/A (cloud-native)             |
| Social engineering        | Not authorized                 |
| DDoS/stress testing       | Requires separate coordination |

### 5.2 Prohibited Actions

- **Data destruction**: No deletion of production data
- **Service disruption**: No actions causing downtime
- **Data exfiltration**: No copying of real user data
- **Lateral movement**: Stay within MirrorBuddy scope
- **Credential stuffing**: No use of breach databases
- **Automated scanning**: Coordinate timing to avoid rate limits

---

## 6. Testing Boundaries

### 6.1 Authorized Testing Windows

| Environment | Window                   | Notification       |
| ----------- | ------------------------ | ------------------ |
| Staging     | 24/7                     | None required      |
| Production  | Weekdays 10:00-18:00 CET | 24h advance notice |

### 6.2 Test Accounts

| Account Type | Purpose                | Credentials      |
| ------------ | ---------------------- | ---------------- |
| Trial user   | Public feature testing | Self-register    |
| Base user    | Authenticated features | Provided by team |
| Pro user     | Premium features       | Provided by team |
| Admin user   | Admin panel testing    | Provided by team |
| COPPA minor  | Parental consent flow  | Test account     |

### 6.3 Rate Limits

| Endpoint Type  | Limit   | Coordination      |
| -------------- | ------- | ----------------- |
| Authentication | 5/15min | Test slowly       |
| API general    | 100/min | Pace requests     |
| AI chat        | 20/min  | Coordinate timing |

---

## 7. OWASP Top 10 (2021) Checklist

| #   | Category                  | Status         | Notes                                   |
| --- | ------------------------- | -------------- | --------------------------------------- |
| A01 | Broken Access Control     | ✅ Implemented | Role-based auth, session validation     |
| A02 | Cryptographic Failures    | ✅ Implemented | TLS 1.3, AES-256, signed cookies        |
| A03 | Injection                 | ✅ Implemented | Prisma ORM (parameterized), CSP headers |
| A04 | Insecure Design           | ✅ Implemented | DPIA, threat modeling documented        |
| A05 | Security Misconfiguration | ⚠️ Test        | CSP, headers, error handling            |
| A06 | Vulnerable Components     | ✅ Implemented | npm audit, Dependabot                   |
| A07 | Auth Failures             | ✅ Implemented | Rate limiting, CSRF, secure cookies     |
| A08 | Data Integrity Failures   | ⚠️ Test        | Verify input validation                 |
| A09 | Logging & Monitoring      | ✅ Implemented | Audit logs, Sentry, Grafana             |
| A10 | SSRF                      | ⚠️ Test        | Verify external request handling        |

---

## 8. Recommended Test Cases

### 8.1 CRITICAL Priority

| ID   | Test Case                        | Target              |
| ---- | -------------------------------- | ------------------- |
| C-01 | Authentication bypass attempts   | /api/auth/\*        |
| C-02 | Session hijacking/fixation       | Session cookies     |
| C-03 | OAuth state parameter validation | /api/auth/google/\* |
| C-04 | CSRF token bypass                | All POST endpoints  |
| C-05 | Admin privilege escalation       | /api/admin/\*       |
| C-06 | Payment manipulation             | Stripe webhooks     |
| C-07 | COPPA consent bypass             | /api/coppa/\*       |

### 8.2 HIGH Priority

| ID   | Test Case                  | Target                  |
| ---- | -------------------------- | ----------------------- |
| H-01 | AI prompt injection        | /api/chat/\*            |
| H-02 | Jailbreak attempts         | AI safety filters       |
| H-03 | IDOR on user resources     | /api/conversations/[id] |
| H-04 | Data export without auth   | /api/privacy/\*         |
| H-05 | SQL injection (verify ORM) | All endpoints           |
| H-06 | XSS in user content        | Chat, materials         |
| H-07 | File upload validation     | /api/study-kit/upload   |

### 8.3 MEDIUM Priority

| ID   | Test Case                  | Target                          |
| ---- | -------------------------- | ------------------------------- |
| M-01 | Rate limit bypass          | All endpoints                   |
| M-02 | Information disclosure     | Error messages                  |
| M-03 | Cookie security attributes | All cookies                     |
| M-04 | CSP bypass                 | Frontend                        |
| M-05 | WebSocket/SSE security     | /api/collab/sse, /api/tools/sse |

---

## 9. Deliverables Expected

1. **Executive Summary**: High-level findings for leadership
2. **Technical Report**: Detailed findings with reproduction steps
3. **Risk Ratings**: CVSS scores for each finding
4. **Remediation Guidance**: Specific fix recommendations
5. **Retest Confirmation**: Verification of fixes

---

## 10. Emergency Contacts

| Role              | Contact                 | Availability      |
| ----------------- | ----------------------- | ----------------- |
| Security Lead     | security@mirrorbuddy.it | 24/7 for critical |
| Engineering Lead  | [Provided separately]   | Business hours    |
| Incident Response | [Provided separately]   | 24/7              |

**Emergency Halt Procedure**: If critical vulnerability discovered affecting live users, immediately contact Security Lead. Do not exploit further.

---

## Appendix A: HTTP Methods by Endpoint Category

| Category      | GET | POST | PUT | PATCH | DELETE |
| ------------- | --- | ---- | --- | ----- | ------ |
| Auth          | ✓   | ✓    | -   | -     | -      |
| Chat          | -   | ✓    | -   | -     | -      |
| Conversations | ✓   | ✓    | ✓   | -     | ✓      |
| User/Profile  | ✓   | ✓    | ✓   | -     | -      |
| Admin         | ✓   | ✓    | ✓   | -     | ✓      |
| Tools         | ✓   | ✓    | ✓   | -     | ✓      |
| Cron          | -   | ✓    | -   | -     | -      |

---

## Appendix B: Security Headers Expected

```http
Content-Security-Policy: default-src 'self'; script-src 'self' 'nonce-{random}'
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 0
Referrer-Policy: strict-origin-when-cross-origin
Permissions-Policy: camera=(), microphone=(self), geolocation=()
```

---

**Document Control**

| Version | Date          | Author                    | Changes         |
| ------- | ------------- | ------------------------- | --------------- |
| 1.0     | February 2026 | MirrorBuddy Security Team | Initial release |

---

_This document is confidential and intended for authorized security testers only._
