// ============================================================================
// LEARNING PATH DOMAIN
// Progressive learning journeys generated from PDF analysis
// ============================================================================

model LearningPath {
  id          String   @id @default(cuid())
  userId      String
  title       String
  description String?
  subject     String?

  // Source reference
  sourceStudyKitId String?
  sourceStudyKit   StudyKit? @relation(fields: [sourceStudyKitId], references: [id])

  // Progress tracking
  totalTopics       Int    @default(0)
  completedTopics   Int    @default(0)
  progressPercent   Float  @default(0)
  estimatedMinutes  Int    @default(0)

  // Status: generating | ready | in_progress | completed
  status      String   @default("generating")

  // Visual overview (Mermaid diagram)
  visualOverview String?

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  completedAt DateTime?

  // Relations
  topics      LearningPathTopic[]

  @@index([userId])
  @@index([status])
  @@index([sourceStudyKitId])
  @@index([createdAt])
  @@index([userId, status])
}

model LearningPathTopic {
  id          String   @id @default(cuid())
  pathId      String
  path        LearningPath @relation(fields: [pathId], references: [id], onDelete: Cascade)

  order       Int
  title       String
  description String
  keyConcepts String   @default("[]")
  difficulty  String   @default("intermediate")

  // Status: locked | unlocked | in_progress | completed
  status      String   @default("locked")

  // Time estimates
  estimatedMinutes Int @default(10)

  // Quiz performance
  quizScore   Int?

  // Related materials from user's library
  relatedMaterials String @default("[]")

  // Timestamps
  startedAt   DateTime?
  completedAt DateTime?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  steps       TopicStep[]
  attempts    TopicAttempt[]

  @@index([pathId])
  @@index([order])
  @@index([status])
}

model TopicStep {
  id          String   @id @default(cuid())
  topicId     String
  topic       LearningPathTopic @relation(fields: [topicId], references: [id], onDelete: Cascade)

  order       Int
  type        String
  title       String
  content     String   @default("{}")

  // Completion status
  isCompleted Boolean  @default(false)
  completedAt DateTime?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([topicId])
  @@index([order])
  @@index([type])
}

model TopicAttempt {
  id          String   @id @default(cuid())
  topicId     String
  topic       LearningPathTopic @relation(fields: [topicId], references: [id], onDelete: Cascade)
  userId      String

  // Attempt type: quiz | study | review
  type        String   @default("quiz")

  // Quiz results
  score       Int?
  totalQuestions Int?
  correctAnswers Int?
  passed      Boolean  @default(false)

  // Time tracking
  startedAt   DateTime @default(now())
  completedAt DateTime?
  durationSeconds Int?

  // Answers (JSON array for quiz attempts)
  answers     String?

  createdAt   DateTime @default(now())

  @@index([topicId])
  @@index([userId])
  @@index([type])
  @@index([createdAt])
}
