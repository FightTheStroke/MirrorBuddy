// ============================================================================
// INSIGHTS DOMAIN
// Student profiles, parent notes, and homework sessions
// ============================================================================

model StudentInsightProfile {
  id           String    @id @default(cuid())
  userId       String    @unique
  studentName  String

  // Access control (GDPR)
  visibleTo    String    @default("parents")

  // Consent tracking
  parentConsent   Boolean  @default(false)
  studentConsent  Boolean  @default(false)
  consentDate     DateTime?
  deletionRequested DateTime?

  // Synthesized profile data as JSON
  insights     String    @default("[]")
  strengths    String    @default("[]")
  growthAreas  String    @default("[]")
  learningStyle String   @default("{}")
  strategies   String    @default("[]")

  // Historical snapshots
  progressHistory String  @default("[]")

  // Metadata
  sessionCount  Int       @default(0)
  lastSessionId String?
  confidenceScore Float   @default(0.0)

  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // Access log for GDPR audit
  accessLogs   ProfileAccessLog[]

  @@index([userId])
}

model ProfileAccessLog {
  id         String   @id @default(cuid())
  profileId  String
  profile    StudentInsightProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  userId     String
  action     String
  details    String?
  ipAddress  String?
  userAgent  String?

  timestamp  DateTime @default(now())

  @@index([profileId])
  @@index([timestamp])
}

model ParentNote {
  id          String    @id @default(cuid())
  userId      String
  sessionId   String
  maestroId   String
  subject     String
  duration    Int

  // Content
  summary     String
  highlights  String
  concerns    String?
  suggestions String?

  // Timestamps
  generatedAt DateTime  @default(now())
  viewedAt    DateTime?

  @@index([userId])
  @@index([sessionId])
  @@index([generatedAt])
}

model HomeworkSession {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Session data
  subject     String?
  topic       String?
  problemType String?
  status      String   @default("active")

  // Messages and steps (JSON arrays)
  messages String @default("[]")
  steps    String @default("[]")

  // Timing
  startedAt   DateTime @default(now())
  completedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([status])
}
