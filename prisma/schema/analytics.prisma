// ============================================================================
// ANALYTICS DOMAIN
// Telemetry, rate limiting, and safety events
// ============================================================================

model TelemetryEvent {
  id          String   @id @default(cuid())
  eventId     String   @unique

  // Event data
  timestamp   DateTime
  category    String
  action      String
  label       String?
  value       Float?
  metadata    String?

  // Session & user tracking
  sessionId   String
  userId      String?

  createdAt   DateTime @default(now())

  @@index([userId])
  @@index([sessionId])
  @@index([timestamp])
  @@index([category])
  @@index([action])
  @@index([userId, timestamp])
}

model RateLimitEvent {
  id        String   @id @default(cuid())
  userId    String?
  endpoint  String
  limit     Int
  window    Int
  ipAddress String?
  timestamp DateTime @default(now())

  @@index([userId, timestamp])
  @@index([endpoint, timestamp])
  @@index([timestamp])
}

model SafetyEvent {
  id              String    @id @default(cuid())
  userId          String?
  type            String
  severity        String
  conversationId  String?
  resolvedBy      String?
  resolvedAt      DateTime?
  resolution      String?
  timestamp       DateTime  @default(now())

  @@index([userId, timestamp])
  @@index([severity, timestamp])
  @@index([timestamp])
}
